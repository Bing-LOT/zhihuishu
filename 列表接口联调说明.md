# 思政资源列表接口联调说明

## 🎉 已完成的功能

### 1. 列表查询接口集成 ✅
- 接口路径：`/politicalResource/page/list`
- 请求方法：`GET`
- 支持分页、搜索、筛选

### 2. 完整的分页功能 ✅
- 自定义分页组件
- 页码切换
- 每页数量选择（10/20/50/100）
- 总数统计

### 3. 搜索功能 ✅
- 关键词搜索
- 500ms 防抖优化
- 搜索时重置到第一页

### 4. 加载状态管理 ✅
- 加载中动画
- 空状态提示
- 错误处理

### 5. 数据展示优化 ✅
- 显示置顶标记
- 分类标签（政策文件/思政素材）
- 前台显示状态
- 内容预览（限100字符）

## 📋 接口信息

### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| pageIndex | number | ✅ | 页码，默认1 |
| pageSize | number | ✅ | 每页大小，默认10条 |
| keyword | string | ❌ | 搜索关键词 |
| showFront | number | ❌ | 显示状态：1=显示；0=隐藏；不传显示所有 |

**注意：** 当前实现中 `showFront` 参数不传值，显示所有数据。

### 请求示例

```http
GET /politicalResource/page/list?pageIndex=1&pageSize=10&keyword=思政
```

### 响应格式

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "list": [
      {
        "id": 1,
        "title": "新时代中国特色社会主义思想融入专业课程实践",
        "category": 1,
        "contentType": 0,
        "content": "<p>详情内容...</p>",
        "pinTop": 0,
        "showFront": 1,
        "createTime": "2024-12-23 10:00:00",
        "updateTime": "2024-12-23 10:00:00"
      }
    ],
    "total": 100,
    "pageIndex": 1,
    "pageSize": 10
  }
}
```

## 🎨 界面功能

### 1. 列表展示

每个资源项显示：
- **标题** + 徽章（置顶/分类）
- **内容预览**（前100字符）
- **创建时间**
- **序号**（全局序号，跨页连续）
- **显示状态**（前台显示/已隐藏）

### 2. 徽章样式

- **置顶**：红色徽章 `#ff4d4f`
- **政策文件**：蓝色徽章 `#1890ff`
- **思政素材**：绿色徽章 `#52c41a`

### 3. 分页控制

```
共 100 条

[上一页] [1] [2] [3] ... [10] [下一页]   [10 条/页 ▼]
```

特点：
- 当前页高亮（红色背景）
- 前后显示省略号
- 禁用状态半透明
- 支持每页数量选择

### 4. 搜索功能

- 输入关键词搜索
- 500ms 防抖，避免频繁请求
- 搜索时自动跳转到第一页
- 实时更新结果

## 💻 技术实现

### 类型定义

```typescript
// 查询参数
export interface PoliticalResourceListParams {
  pageIndex: number
  pageSize: number
  keyword?: string
  showFront?: 0 | 1
}

// 列表项
export interface PoliticalResourceItem {
  id: string | number
  title: string
  category: 0 | 1
  contentType: 0 | 1
  content: string
  pinTop: 0 | 1
  showFront: 0 | 1
  createTime?: string
  updateTime?: string
}

// 响应数据
export interface PoliticalResourceListResponse {
  list: PoliticalResourceItem[]
  total: number
  pageIndex: number
  pageSize: number
  totalPages?: number
}
```

### API 接口

```typescript
export function getPoliticalResourceList(
  params: PoliticalResourceListParams
): Promise<PoliticalResourceListResponse> {
  return request({
    url: '/politicalResource/page/list',
    method: 'GET',
    params
  })
}
```

### 组件使用

```typescript
// 加载列表
const loadList = async () => {
  try {
    isLoading.value = true
    
    const params = {
      pageIndex: currentPage.value,
      pageSize: pageSize.value,
      keyword: searchKeyword.value || undefined
    }
    
    const response = await getPoliticalResourceList(params)
    items.value = response.list || []
    total.value = response.total || 0
  } catch (error) {
    console.error('列表加载失败:', error)
    alert(`加载失败：${error.message}`)
  } finally {
    isLoading.value = false
  }
}

// 分页改变
const handlePageChange = (page: number) => {
  currentPage.value = page
  loadList()
}

// 搜索（防抖）
const handleSearch = () => {
  if (searchTimer) clearTimeout(searchTimer)
  searchTimer = setTimeout(() => {
    currentPage.value = 1
    loadList()
  }, 500)
}
```

## 🧪 测试步骤

### 1. 启动项目

确保已重启开发服务器（让 Vite 配置生效）：

```bash
npm run dev
```

### 2. 访问页面

```
http://localhost:5173/
登录 → 后台管理 → 资源管理 → 思政资源
```

### 3. 测试功能

#### 测试列表加载
1. 打开页面，应自动加载第一页数据
2. 查看是否显示加载动画
3. 检查数据是否正常显示

#### 测试分页
1. 点击"下一页"按钮
2. 点击具体页码
3. 更改每页数量（10/20/50/100）
4. 验证数据正确切换

#### 测试搜索
1. 在搜索框输入关键词
2. 等待 500ms（防抖）
3. 查看搜索结果
4. 清空关键词，恢复全部数据

#### 测试筛选
1. 选择"全部状态"
2. 选择"显示中"
3. 选择"已隐藏"
4. 验证筛选结果（目前前端未实现，待后续添加）

#### 测试新增后刷新
1. 点击"新增"按钮
2. 填写表单并保存
3. 验证列表自动刷新
4. 检查新数据是否出现在第一页

### 4. 查看网络请求

打开浏览器开发者工具（F12）：

```
Network 标签 → XHR/Fetch

请求示例：
GET /politicalResource/page/list?pageIndex=1&pageSize=10

响应检查：
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "list": [...],
    "total": 100,
    "pageIndex": 1,
    "pageSize": 10
  }
}
```

## 📊 状态管理

```typescript
// 数据状态
const items = ref<PoliticalResourceItem[]>([])       // 列表数据
const total = ref(0)                                  // 总条数
const currentPage = ref(1)                            // 当前页
const pageSize = ref(10)                              // 每页大小
const isLoading = ref(false)                          // 加载状态
const searchKeyword = ref('')                         // 搜索关键词
```

## 🎯 代码优化

### 1. 防抖搜索

避免频繁请求，提升性能：

```typescript
let searchTimer: ReturnType<typeof setTimeout> | null = null
const handleSearch = () => {
  if (searchTimer) clearTimeout(searchTimer)
  searchTimer = setTimeout(() => {
    currentPage.value = 1
    loadList()
  }, 500)
}
```

### 2. 错误处理

完整的 try-catch 异常捕获：

```typescript
try {
  // 请求接口
} catch (error: any) {
  console.error('列表加载失败:', error)
  alert(`加载失败：${error.message || '网络错误'}`)
} finally {
  isLoading.value = false
}
```

### 3. 加载状态

提供良好的用户反馈：

```vue
<div v-if="isLoading" class="loading-state">
  <div class="loading-spinner"></div>
  <p>加载中...</p>
</div>
```

## 📁 相关文件

- `src/types/resource.d.ts` - 类型定义
- `src/api/resource.ts` - API 接口
- `src/components/common/Pagination/index.vue` - 分页组件
- `src/views/admin/Resources/ResourceList.vue` - 资源列表页面
- `vite.config.ts` - 代理配置（已添加 politicalResource）

## 🔧 待完成功能

### 1. 编辑功能
- 当前点击编辑会提示"编辑功能待实现"
- 需要后端提供编辑接口

### 2. 删除功能
- 当前只做本地删除
- 需要后端提供删除接口

### 3. 拖拽排序
- 当前只做本地交换
- 需要后端提供排序接口

### 4. 前台显示状态筛选
- UI 已有筛选框
- 可通过 `showFront` 参数实现
- 需要时取消注释相关代码

## ⚠️ 注意事项

### 1. Vite 代理配置

确保 `vite.config.ts` 中包含 `politicalResource`：

```typescript
'^/(upload|banner|resource|politicalResource|course|exam|analysis|ai|auth)': {
  target: proxyTarget,
  changeOrigin: true,
  secure: false,
  ws: true,
  rewrite: (path) => path
}
```

**修改后必须重启开发服务器！**

### 2. 响应数据格式

后端返回的数据必须包含：
- `list`: 数据列表数组
- `total`: 总条数
- `pageIndex`: 当前页码
- `pageSize`: 每页大小

### 3. 搜索关键词

- 可搜索标题、内容等字段
- 后端需实现模糊查询
- 前端传递 `keyword` 参数

### 4. showFront 参数

当前实现中不传此参数（显示所有数据）。如需筛选：

```typescript
const params = {
  pageIndex: currentPage.value,
  pageSize: pageSize.value,
  keyword: searchKeyword.value || undefined,
  showFront: statusFilter.value === 'active' ? 1 : 
             statusFilter.value === 'inactive' ? 0 : 
             undefined
}
```

## ✨ 功能亮点

1. **完整的分页组件**
   - 智能页码显示（带省略号）
   - 支持快速跳转
   - 每页数量可调整

2. **防抖搜索**
   - 500ms 延迟
   - 减少服务器压力
   - 提升用户体验

3. **加载状态管理**
   - 加载动画
   - 空状态提示
   - 错误友好提示

4. **数据可视化**
   - 彩色徽章标记
   - 状态一目了然
   - 信息展示完整

5. **响应式设计**
   - 适配不同屏幕
   - 优雅的过渡动画
   - 统一的视觉风格

---

**列表功能已完成，可以开始测试！** 🎊

记得先重启开发服务器哦！

