# 红色文化资源地图使用说明

## 功能概述

在"学习实践"页面的第三个区块"红色文化资源地图（福州地区）"，我们集成了高德地图开放平台，实现了动态地图展示和资源点标记功能。

## 功能特点

### 1. 动态地图展示
- 使用高德地图 API 2.0
- 支持地图缩放、拖拽、平移等交互
- 默认中心点：福州市中心（119.296°E, 26.075°N）
- 默认缩放级别：12

### 2. 资源列表
左侧显示文化资源列表，包含以下信息：
- 资源名称
- 资源类型（博物馆、人物故居、烈士陵园、党校等）
- 资源封面图
- 资源描述
- 搜索功能

### 3. 地图标记
点击左侧资源列表项时：
- 地图自动定位到该资源位置
- 添加自定义红色标记点
- 显示资源名称标签
- 自动弹出信息窗口

### 4. 信息窗口
信息窗口显示详细信息：
- 资源名称
- 资源类型
- 资源描述
- 详细地址
- 位置图标

### 5. 详情卡片
右下角固定显示详情卡片（悬浮在地图上）：
- 资源封面图片
- 资源名称和类型
- 资源详细描述
- 详细地址和位置图标
- 随选中资源动态更新

## 技术实现

### 依赖包
```json
{
  "@amap/amap-jsapi-loader": "^1.0.1"
}
```

### 主要组件

#### 1. 地图容器
```vue
<div ref="mapContainer" class="amap-container"></div>
```

#### 2. 资源数据结构
```typescript
interface CultureResource {
  id: string          // 唯一标识
  name: string        // 资源名称
  type: string        // 资源类型
  cover: string       // 封面图片
  description: string // 资源描述
  longitude: number   // 经度（GCJ-02坐标系）
  latitude: number    // 纬度（GCJ-02坐标系）
  address: string     // 详细地址
}
```

#### 3. 核心函数

##### initMap()
初始化高德地图实例
- 加载高德地图 API
- 创建地图实例
- 添加比例尺和工具栏
- 默认选中第一个资源

##### addMarkerToMap(resource)
在地图上添加标记
- 清除之前的标记
- 创建自定义标记内容（红色水滴形状）
- 创建信息窗口
- 地图中心移动到标记位置
- 自动打开信息窗口

##### selectResource(resource)
选择资源
- 更新当前选中资源
- 在地图上添加标记

## 预设资源数据

系统预设了7个福州地区的红色文化资源：

1. **福建省革命历史纪念馆**（博物馆）
   - 位置：福州市鼓楼区五四路263号
   - 坐标：119.300°E, 26.075°N

2. **林觉民故居**（人物故居）
   - 位置：福州市鼓楼区杨桥东路
   - 坐标：119.305°E, 26.080°N

3. **福州文林山革命烈士陵园**（烈士陵园）
   - 位置：福州市鼓楼区文林山
   - 坐标：119.310°E, 26.085°N

4. **中共福建省委党校**（党校）
   - 位置：福州市鼓楼区柳河路61号
   - 坐标：119.295°E, 26.070°N

5. **福州市委党群服务中心**（党群中心）
   - 位置：福州市鼓楼区古田路
   - 坐标：119.290°E, 26.065°N

6. **福州市博物馆**（纪念馆）
   - 位置：福州市晋安区文博路8号
   - 坐标：119.315°E, 26.090°N

7. **闽侯县五虎山革命根据地**（革命地址）
   - 位置：福州市闽侯县
   - 坐标：119.280°E, 26.060°N

## 用户交互流程

```
1. 用户进入"学习实践"页面
   ↓
2. 页面加载，初始化地图
   ↓
3. 地图中心定位到福州市
   ↓
4. 默认选中第一个资源（福建省革命历史纪念馆）
   ↓
5. 地图上显示该资源的标记和信息窗口
   ↓
6. 用户点击左侧资源列表中的其他资源
   ↓
7. 地图自动定位到新资源位置
   ↓
8. 移除旧标记，添加新标记
   ↓
9. 自动弹出信息窗口显示详情
```

## 样式定制

### 资源列表激活状态
```css
.culture-resource-item--active {
  background: rgba(188, 34, 32, 0.1);
  border-left: 2px solid #bc2220;
  border-right: 2px solid #bc2220;
}
```

### 地图容器
```css
.amap-container {
  width: 100%;
  height: 100%;
  border-radius: 16px;
  overflow: hidden;
}
```

### 自定义标记样式
- 白色标签背景，圆角8px
- 红色水滴形状标记点（#bc2220）
- 白色圆点中心
- 阴影效果

## 扩展功能建议

### 1. 后端接口集成
将静态资源数据改为从后端API获取：

```typescript
import { getRedCultureList } from '@/api/redCulture'

const fetchCultureResources = async () => {
  try {
    const data = await getRedCultureList()
    cultureResources.value = data.map(item => ({
      id: item.id,
      name: item.name,
      type: item.type,
      cover: item.coverUrl,
      description: item.description,
      longitude: item.longitude,
      latitude: item.latitude,
      address: item.address
    }))
  } catch (error) {
    console.error('获取红色文化资源失败:', error)
  }
}
```

### 2. 搜索功能实现
在 `handleSearch` 函数中添加搜索逻辑：

```typescript
const handleSearch = () => {
  if (!searchQuery.value.trim()) {
    // 显示所有资源
    return
  }
  
  // 根据关键词过滤资源
  const filtered = cultureResources.value.filter(resource => 
    resource.name.includes(searchQuery.value) ||
    resource.type.includes(searchQuery.value) ||
    resource.address.includes(searchQuery.value)
  )
  
  // 更新列表显示
  // ...
}
```

### 3. 显示所有资源标记
同时在地图上显示所有资源的标记：

```typescript
const addAllMarkersToMap = () => {
  markers.forEach(marker => map.remove(marker))
  markers = []
  
  cultureResources.value.forEach(resource => {
    const marker = new AMap.Marker({
      position: [resource.longitude, resource.latitude],
      // ... 标记配置
    })
    
    marker.on('click', () => {
      selectResource(resource)
    })
    
    map.add(marker)
    markers.push(marker)
  })
}
```

### 4. 聚合标记
当地图缩放级别较小时，使用标记聚合功能：

```typescript
plugins: ["AMap.Scale", "AMap.ToolBar", "AMap.Marker", "AMap.MarkerCluster"]
```

### 5. 路线规划
添加"如何到达"功能，规划从当前位置到资源点的路线。

### 6. 街景功能
集成高德地图街景功能，让用户可以查看资源点的实景。

## 注意事项

1. **API Key 配置**：使用前必须配置有效的高德地图 API Key
2. **坐标系统**：确保坐标使用 GCJ-02（火星坐标系）
3. **网络依赖**：地图加载需要网络连接
4. **性能优化**：资源点较多时，建议使用标记聚合
5. **移动端适配**：当前设计主要针对 PC 端，移动端可能需要额外适配

## 相关文件

- `src/views/portal/Study/index.vue` - 学习实践页面主文件
- `高德地图配置说明.md` - 高德地图 API Key 配置说明
- `package.json` - 项目依赖配置

## 更新日志

### v1.0.0 (2025-12-25)
- ✅ 集成高德地图 API
- ✅ 实现资源列表展示
- ✅ 实现点击资源定位功能
- ✅ 实现自定义标记样式
- ✅ 实现信息窗口展示
- ✅ 添加地图控件（缩放、比例尺）

## 未来规划

- [ ] 接入后端API获取真实数据
- [ ] 实现搜索功能
- [ ] 显示所有资源标记
- [ ] 添加标记聚合功能
- [ ] 添加路线规划功能
- [ ] 优化移动端体验
- [ ] 添加资源详情页跳转

